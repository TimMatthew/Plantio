
---

## ‚ñ∂Ô∏è 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

### 1.1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ

```bash
python -m venv .venv
source .venv/bin/activate     # Linux/Mac
.\.venv\Scripts\activate      # Windows
````

### 1.2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```bash
pip install -r requirements.txt
```

### 1.3. –ó–∞–ø—É—Å–∫ MongoDB

–í–∞—Ä—ñ–∞–Ω—Ç 1 ‚Äî Docker:

```bash
docker run -d \
  -p 27017:27017 \
  --name plantio-mongo \
  mongo:7
```

–í–∞—Ä—ñ–∞–Ω—Ç 2 ‚Äî –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ MongoDB.

### 1.4. –í–∫–∞–∑–∞—Ç–∏ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:

```bash
export MONGODB_URL="mongodb://localhost:27017"
```

Windows PowerShell:

```powershell
$env:MONGODB_URL="mongodb://localhost:27017"
```

### 1.5. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ FastAPI

```bash
uvicorn app.main:app --reload
```

API –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–µ –∑–∞:

```
http://localhost:8000
```

Swagger UI:

```
http://localhost:8000/docs
```

---

## üìÅ 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```
app/
  api/
    v1/
      endpoints/
        diagnose.py       # –æ—Å–Ω–æ–≤–Ω–∏–π –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
  core/
    label_mapping.py      # –º–µ–ø—ñ–Ω–≥–∏ (–Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è) –Ω–∞–∑–≤ —Ä–æ—Å–ª–∏–Ω/—Ö–≤–æ—Ä–æ–±
    config.py             # –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è FastAPI
  models/
    plant.py              # –º–æ–¥–µ–ª—å Plant (MongoDB)
    diagnosis.py          # –º–æ–¥–µ–ª—å Diagnosis (MongoDB)
  services/
    inference.py          # —Ä–æ–±–æ—Ç–∞ –∑ ML-–º–æ–¥–µ–ª–ª—é
    storage.py            # –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å –ª–æ–∫–∞–ª—å–Ω–æ
class_map.json            # –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∫–ª–∞—Å—ñ–≤ –º–æ–¥–µ–ª—ñ —Ä–æ—Å–ª–∏–Ω–∞–º/—Ö–≤–æ—Ä–æ–±–∞–º
```

---

## üå± 3. –Ø–∫ –ø—Ä–∞—Ü—é—î –ª–æ–≥—ñ–∫–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (`POST /diagnose`)

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–æ—Ç–æ (`UploadFile`).
2. –ú–æ–¥–µ–ª—å –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤:

   ```
   [
     { plant_label, disease_label, confidence, ... }
   ]
   ```
3. –§—É–Ω–∫—Ü—ñ—è `_enrich_candidates_with_embedded()`:

   * –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î –Ω–∞–∑–≤–∏ —á–µ—Ä–µ–∑ `label_mapping.py`;
   * —à—É–∫–∞—î —Ä–æ—Å–ª–∏–Ω—É/—Ö–≤–æ—Ä–æ–±—É –≤ MongoDB;
   * —Ñ–æ—Ä–º—É—î –ª—é–¥–∏–Ω–æ–∑—Ä–æ–∑—É–º—ñ–ª—ñ –Ω–∞–∑–≤–∏ (`plant_name`, `disease_name`);
   * –∑–∞–ª–∏—à–∞—î **—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –º–æ–¥–µ–ª—ñ** (`disease_id`) –±–µ–∑ –∑–º—ñ–Ω.
4. API –ø–æ–≤–µ—Ä—Ç–∞—î:

   * `plantId`
   * `decidedDiseaseId` ‚Äî **—Ü–µ —Å–∏—Ä–∏–π label –º–æ–¥–µ–ª—ñ**, —è–∫–æ–≥–æ –≤–∏–º–∞–≥–∞—é—Ç—å —Ç–µ—Å—Ç–∏
   * `candidates` ‚Äî –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫
5. –Ø–∫—â–æ –≤—Å—ñ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ < threshold ‚Üí 422 (`low_confidence`).

---

## üß™ 4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤

```bash
pytest -q
```

–ü–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è:

* –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ `/diagnose`;
* –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å `decidedDiseaseId`;
* –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å –º–µ–ø—ñ–Ω–≥—É –Ω–∞–∑–≤;
* —Ä–æ–±–æ—Ç–∞ –∑—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º `Diagnosis`.

---

## üîß 5. Pre-commit –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

–£ –ø—Ä–æ—î–∫—Ç—ñ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ:

* **ruff** ‚Äî –ª—ñ–Ω—Ç–µ—Ä —Ç–∞ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–µ—Ä
* **black** ‚Äî —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
* **isort** ‚Äî —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —ñ–º–ø–æ—Ä—Ç—ñ–≤
* **mypy** ‚Äî —Å—Ç–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏–ø—ñ–≤
* **pytest** ‚Äî —à–≤–∏–¥–∫—ñ —Ç–µ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∫–æ–º—ñ—Ç–æ–º

–ö–æ–Ω—Ñ—ñ–≥-—Ñ–∞–π–ª–∏:

```
pyproject.toml
.pre-commit-config.yaml
```

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è hook'—ñ–≤:

```bash
pre-commit install
```

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –ø–µ—Ä–µ–¥ –∫–æ–∂–Ω–∏–º –∫–æ–º—ñ—Ç–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∏–ª—é.

---

## üë®‚Äçüíª 6. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π Git-—Ñ–ª–æ—É

### –ü–µ—Ä–µ–¥ –∫–æ–º—ñ—Ç–æ–º:

```bash
pre-commit run --all-files
pytest
```

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ä–æ–±–æ—á–∏–π —Ü–∏–∫–ª:

```bash
git checkout -b feature/my-feature
# ...—Ä–æ–±–∏—à –∑–º—ñ–Ω–∏...
pre-commit run --all-files
pytest
git add .
git commit -m "feat: –æ–ø–∏—Å –∑–º—ñ–Ω"
git push origin feature/my-feature
```

---

## üîÑ 7. –Ø–∫ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ –∫–æ–ª–∏ –¥–æ–¥–∞—î—Ç—å—Å—è –Ω–æ–≤–∞ —Ä–æ—Å–ª–∏–Ω–∞ –∞–±–æ —Ö–≤–æ—Ä–æ–±–∞

### 1) –î–æ–¥–∞—Ç–∏ –∞–±–æ –æ–Ω–æ–≤–∏—Ç–∏ –∑–∞–ø–∏—Å–∏ —É `class_map.json`.

### 2) –û–Ω–æ–≤–∏—Ç–∏:

* `PLANT_NAME_MAP`
* `DISEASE_NAME_MAP`
* `PAIR_DISEASE_NAME_MAP`

—É `label_mapping.py`.

### 3) –î–æ–¥–∞—Ç–∏/–æ–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ –≤ MongoDB (`plantio.plants.json` –∞–±–æ –∫–æ–ª–µ–∫—Ü—ñ—è `plants`).

### 4) –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø—Ä–æ—î–∫—Ç:

```bash
uvicorn app.main:app --reload
```

### 5) –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:

```bash
pytest
```

---

## üö® 8. –¢–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏

| –°–∏–º–ø—Ç–æ–º                       | –ü—Ä–∏—á–∏–Ω–∞                                  | –Ø–∫ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏                                            |
| ----------------------------- | ---------------------------------------- | ------------------------------------------------------- |
| `plant_id = null`             | –Ω–∞–∑–≤–∞ —Ä–æ—Å–ª–∏–Ω–∏ –∑ –º–æ–¥–µ–ª—ñ ‚â† –Ω–∞–∑–≤—ñ –≤ MongoDB | –¥–æ–¥–∞—Ç–∏ —É `PLANT_NAME_MAP`                               |
| `disease_name = null`         | —Ö–≤–æ—Ä–æ–±–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞                      | –¥–æ–¥–∞—Ç–∏ —É `DISEASE_NAME_MAP` –∞–±–æ `PAIR_DISEASE_NAME_MAP` |
| –ø–æ–º–∏–ª–∫–æ–≤–∏–π `decidedDiseaseId` | –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –Ω–∞–∑–≤–∞ –ø—ñ–¥–º—ñ–Ω–∏–ª–∞ label       | –ø–æ–≤–µ—Ä—Ç–∞–π —É `disease_id` **—Ç—ñ–ª—å–∫–∏ –º–æ–¥–µ–ª—å–Ω–∏–π label**      |
| –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î 422      | –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å < threshold                  | –∑–Ω–∏–∑–∏—Ç–∏ threshold –∞–±–æ –æ–Ω–æ–≤–∏—Ç–∏ –º–æ–¥–µ–ª—å                    |

---

## üìú 9. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

* **FastAPI** ‚Äî –≥–æ–ª–æ–≤–Ω–µ API.
* **Motor + MongoDB** ‚Äî –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ä–æ—Å–ª–∏–Ω —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—ó –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
* **–ú–æ–¥–µ–ª—å ML** –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ `inference.py`.
* **label_mapping.py** –∑–∞–±–µ–∑–ø–µ—á—É—î –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é:

  * –∞–Ω–≥–ª. ‚Üí —É–∫—Ä.
  * —Å–ª—É–∂–±–æ–≤—ñ –∫–ª–∞—Å–∏ ‚Üí —Ä–µ–∞–ª—å–Ω—ñ —Ä–æ—Å–ª–∏–Ω–∏
  * –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ (–Ω–∞–ø—Ä. Late Blight —É –∫–∞—Ä—Ç–æ–ø–ª—ñ —Ç–∞ —Ç–æ–º–∞—Ç—ñ)
* **Diagnosis** –∑–±–µ—Ä—ñ–≥–∞—î –º–µ—Ç–∞–¥–∞–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É.

---

## ‚úîÔ∏è 10. –ê–≤—Ç–æ—Ä—Å—Ç–≤–æ

–ü—Ä–æ—î–∫—Ç –≤–∏–∫–æ–Ω–∞–Ω–æ —Å—Ç—É–¥–µ–Ω—Ç—Å—å–∫–æ—é –∫–æ–º–∞–Ω–¥–æ—é —É —Å–∫–ª–∞–¥—ñ:
–ú–∞—Ç—ñ–π—á–∏–∫ –¢–∏–º–æ—Ñ—ñ–π, –†—É–¥–∞—Å –í–ª–∞–¥–∏—Å–ª–∞–≤–∞, –£–∫—Ä–∞—ó–Ω–µ—Ü—å –î–º–∏—Ç—Ä–æ, –°–ª—ñ–ø—É—à–∫—ñ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–∞, –ë–∞—Ä–∞–Ω—ñ–≤—Å—å–∫–∏–π –Ø—Ä–æ—Å–ª–∞–≤ ‚Äî —É —Ä–∞–º–∫–∞—Ö –Ω–∞–≤—á–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å—É ¬´–ü—Ä–æ—î–∫—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–Ω–∏—Ö —Å–∏—Å—Ç–µ–º¬ª.

```